# .ebextensions/09-https-redirect.config
files:
  "/etc/httpd/conf.d/zzz_https_redirect.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      RewriteEngine On
      # Redirect HTTP to HTTPS if coming from WhatsApp or mobile apps
      RewriteCond %{HTTP_USER_AGENT} .*WhatsApp.* [OR]
      RewriteCond %{HTTP_USER_AGENT} .*Mobile.* [OR]
      RewriteCond %{HTTP_USER_AGENT} .*Android.* [OR]
      RewriteCond %{HTTP_USER_AGENT} .*iPhone.*
      RewriteRule ^(.*)$ http://%{HTTP_HOST}%{REQUEST_URI} [L]

container_commands:
  01_enable_rewrite:
    command: "a2enmod rewrite"
    ignoreErrors: true
  02_restart_apache:
    command: "systemctl restart httpd"
    ignoreErrors: true